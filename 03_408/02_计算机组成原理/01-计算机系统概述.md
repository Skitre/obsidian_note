## 计算机系统层次结构
### 计算机系统的基本组成
**概念**
- 硬件：
	- 有形的物理设备，是计算机系统中的实际物理装置的总称；
- 软件：
	- 在硬件上运行的程序以及相关的数据即文档；
- 注：
	- 1.计算机性能的好坏，主要是通过软件的效率以及作用体现出来的；
	- 若一功能既可以使用硬件实现，又可以使用软件实现，则称其是*软/硬件在逻辑功能上是等价*的。
### 计算机硬件的基本结构
#### 冯诺伊曼机的基本思想
**概念**
- 冯诺伊曼机的特点
	- 1、计算机采用五大部件：*运算器、控制器、存储器、输入设备、输出设备*
	- 2、采用*存储程序*（见下文）的工作方式
	- 3、数据和指令均采用二进制代码的形式
	- 4、指令和数据以同等地位存于存储器，但计算机能区分它们（指令不同阶段）
	- 5、指令由操作码和地址码构成，*操作码*指明*操作的类型*，*地址码*指出*操作的地址*
**概念**
- 存储程序的思想：
	- 将指令以二进制代码的形式实现输入计算机的主存储器，然后按其在存储器中的首地址执行程序的第一条指令，以后就按该程序的规定顺序执行其他指令，直至程序执行结束
- 分析：
	- ![[t1.png]]
	- 指令中提供的是地址，没有直接给出，*C错误*
#### 计算机的功能部件
**概念**
- 输入设备：
	- 输入设备的只要功能是将程序和数据以机器所能识别和接收的信息形式输入计算机；
- 输出设备：
	- 输出设备的任务是将计算机处理的结果以人们所能接受的形式或其他系统所要求的信息形式输出；
- 存储器：
	- 种类：
		- 主存储器（内存储器或主存）
			- CPU能直接访问的存储器是主存储器
			- 主存储器的工作方式是按存储单元的地址进行存取，这种存取方式称为*按地址存取方式*
		- 辅存储器（外存储器或外存）
			- 辅助存储器用于帮助贮存记忆更多信息
			- 辅存储器中的信息必须*调入主存储器才能为CPU访问
- 运算器：
	- 功能：
		- 运算器是计算机的执行部件，用于进行算术运算和逻辑运算
	- 组成：
		- 算术逻辑单元（Arithmetic and Logic Unit,ALU）
		- 若干*通用寄存器*
			- 用于暂存操作数和中间结果，如累加器（ACC），乘商寄存器（MQ）、操作数寄存器（X）、变址寄存器（IX）、基址寄存器
		- 程序状态寄存器
			- 也称*标志寄存器*，用于存放ALU运算得到的一些标志信息或处理机的状态信息，如结果是否溢出、有无产生进位或错位、结果是否为负等
- 控制器：
	- 功能：
		- 控制器是计算机的指挥中心，由其“指挥”各部件自动协调地进行工作
	- 组成：
		- 程序计数器（PC）
			- OC用来存放当前欲执行*指令的地址*，具有自动加“1”（指的是一个指令长度）的功能，可自动形成下一条指令的地址
			- 与主存储器的MAR之间有一条直接通路
		- 指令存储器（IR）
			- IR用来存放当前的指令，内容取自主存储器的*MDR*
			- 地址码Ad(IR)送往MAR，用以取操作数
		- 控制单元（CU）
			- 指令中的操作码OP(IR)送至CU，用以*分析指令*并发出各种微操作命令序列
		- 总线
			- *CPU*与主存储器之间通过一组总线相连，总线中有地址、控制和数据三组信号线
			- MAR中的细致信息会直接送到地址线上，用于指向读/写操作的主存储器存储单元
			- 控制线中有读/写信号线，指出数据是从CPU写入主存还是从主存读出到CPU，根据是读操作还是写操作来控制MDR中的数据是送到数据线上还是将数据线上的数据接收到MDR中
>![[计算机组成.png]]

**主存储器组成结构**
- 存储体：
	- 存储体由许多*存储单元*组成，每个存储单元包含若干*存储元件*，每个存储元件存储一位二进制代码0或1
	- *存储单元*可以存储*一串二进制代码*，称这串代码为*存储字*
	- 物理关系：存储体 $\to$ 存储单元 $\to$ 存储元件
	- 逻辑关系：存储字长 $\to$ 存储字 $\to$ 二进制数据
- 存储器地址寄存器（MAR）：
	- 用于寻址，其位数反应最多可寻址的*存储单元*的个数
		- 如：MAR 为 10 位，则最多有 $2^{10}=1024$ 个存储单元，记为 *1 k*
	- MAR 长度与 PC 长度相等（要满足有多少条指令）
- 存储器数据寄存器 （MDR）：
	- 其为数通常等于存储字长，一般为字节的 2 次幂的整数倍
> ![[存储体.png]]
### 计算机上的软件
**概念**
- 三类程序：
	- 1、汇编程序（汇编器）
		- 将汇编语言程序翻译为机器语言程序
	- 2、解释程序（解释器）
		- 将源程序中的语句按执行顺序逐条翻译成机器指令并立即执行
	- 3、编译程序（编译器）
		- 将高级语言程序翻译为汇编语言或机器语言的程序
- 软/硬件逻辑功能等价性
	- 若一功能既可以使用硬件实现，又可以使用软件实现，则称其是*软/硬件在逻辑功能上是等价的*
### 计算机系统的层次结构
**概念**
- 第 1级
	- *微程序机器层*
	- 是一个实在的硬件层，由机器硬件直接执行微指令
- 第 2级
	- *传统机器语言层*
	- 也是一个实际的机器层，由微程序来解释机器指令系统
- 第 3 级
	- *操作系统层*
	- 由操作系统程序实现，操作系统程序是由机器指令和广义指令组成的，这些广义指令是为了扩展机器功能而设置的，是由操作系统定义和解释的软件指令，所以这一层也称混合层；
- 第 4 级
	- *汇编语言层*
	- 由汇编程序支持和执行，借此可编写汇编语言源程序
- 第 5 级
	- *高级语言层*
	- 面向用户的，方便用户编写应用程序而设置
	- 该层由各种高级语言编译程序支持和执行
**概念**
- ISA-指令集体系结构
	- ISA定义了一台计算机可以执行的所有指令的集合，每条指令规定了计算机执行什么操作，以及所处理的操作数存放的地址空间和操作数类型；
### 计算机系统的工作原理
#### 存储程序的工作方式
**概念**
- 存储程序的工作方式
	- “存储程序”工作方式规定，程序执行前，需要将程序所含的指令和数据送入*主存储器*，当程序被启动执行，就无须操作人员的干预，自动逐条完成指令的取出和执行任务；
- 过程：
	- 每条指令的执行包括：
		- 从主存储器中取指令
		- 对指令进行译码
		- 计算下条指令地址
		- 取操作数并执行
		- 将结果送回存储器
> ![[存储程序工作.png]] 
-存储程序工作方式
> - ![[Pasted image 20250629184419.png]] 单周期流水线程序执行框图

#### 从源程序到可执行文件
**概念**
- 四个阶段
	- 预处理阶段
		- 预处理器（cpp）对源程序中以字符 "#"开头的命令进行处理，例如将“ # include ”命令后面的.h 文件内容插入程序文件
	- 编译阶段
		- 汇编器对预处理后的源程序进行编译，生成一个汇编语言程序 hello.s
		- 汇编语言源程序中的每条语句都以一种文本格式描述了一条低级机器语言指令
	- 汇编阶段
		- 汇编器将 hello.s 翻译为机器语言指令，把这些指令打包成一个称为可重定位目标文件 hello.o，它是一种二进制文件
	- 链接阶段
		- 链接器（ld）将多个可重定位目标文件和标准库函数合并为一个可执行目标文件，简称可执行文件
	- 如图
	- ![[Pasted image 20250629185459.png]]
	- 术语：
		- 高级语言程序
		- 机器及目标代码文件 $\to$ 汇编代码文件
		- 机器语言程序 $\to$ 计算机硬件直接执行的程序
	- 补充：
		- 解释执行
			- 将原代码一条语句翻译为机器代码并*立即执行*
			- 翻译一条执行一条（像不像调试？）
#### 指令执行过程的描述
**举例**
- 取数指令
	- 取指令：PC $\to$ MAR $\to$ M $\to$ MAR $\to$ IR
	- 分析指令：OP（IR）$\to$ CU
	- 执行指令：Ad（R）$\to$ MAR $\to$ M $\to$ MDR $\to$ ACC

## 计算机性能指标
### 存储衡量单位
**概念**
- 字
	- 用来表示*被处理信息的单位*，用来衡量*数据类型的宽度*
	- 如：x 86 机器中将一个字定义为 16 位
- 字长
	- 计算机的每个字包含的位数称为字长
	- 指 CPU 内部用于整数运算的数据通路的宽度
	- 此字长等于 CPU 内部用于整数运算的 *ALU 位数*和*通用寄存器宽度*，反映了计算机处理信息的能力
- 机器字长
	- 机器字长通常与 CPU 的寄存器位数、ALU 位数有关，因此字长一般等于*ALU 位数*和*通用寄存器宽度*
- 指令字长
	- 一个指令字中包含的二进制代码的位数；
	- 必须是*字节的整数倍*；
	- 指令字长一般取存储字长的整数倍，若指令字长等于存储字长的2倍，则需要2个访存周期来取出一条指令：若指令字长等于存储字长，则取指令周期等于机器周期；
- 存储字长
	- 一个*存储单元*存储的二进制代码的位数
	- 必须是字节的整数倍
**概念**
- 数据通路带宽
	- 指总线一次能*并行传送*信息的*位数*
	- 这里所说的数据通路宽度指*外部数据总线的宽度*，区别于 cpu 内的数据总线
**概念**
- 主存容量
	- 指主存所能存储信息的最大容量，通常以*字节*来衡量，也可用 $字数\times 字长$ (如 $512k\times 16$ 位) 来表示存储容量
	- MAR 的位数反应存储单元个数
	- MDR 的位数反应存储子长
### 运算速度指标
**概念**
- 吞吐量
	- 系统在*单位时间内处理请求的数量*
	- 取决于信息能多快地输入内存，CPU 能多快地 IF，数据能多快地从内存中取出或存入.......
	- 每步都关系到主存
	- 系统吞吐量*主要取决于主存储器地存取周期*
- 响应时间
	- 指从用户向计算机发送一个请求，到系统对该请求做出相应并获得所需结果的*等待时间*
	- 包括：
		- CPU 时间（运行一个程序所花费的时间）
		- 等待时间（用于磁盘访问、存储器访问、I/O 操作、操作系统开销等时间）
**概念**
- 时钟脉冲信号
	- 由机器脉冲源发出脉冲信号经整形和分频后形成
- 时钟周期
	- 机器内部*主时钟脉冲信号的宽度*，是 cpu 工作的*最小时间单位*
	- 限制因素
		- 时钟周期以相邻状态单元间*组合逻辑电路的最大延迟*为基准确定；
		- 时钟周期也以指令流水线的*每个流水段的最大延迟*时间确定；
- 主频
	- 又称 CPUI 时钟频率，所以是时钟周期的倒数即每秒有多少个周期
	- 衡量机器速度的重要参数，对于同一型号的计算机，主频越高完成指令的一个执行步骤时间越短，执行指令的速度越快（我的电脑 cpu 为 i 5-12600 kf，默频 3.6 Ghz, 一秒3600000000 个时钟周期）
**概念**
- CPI（Cycle Per Instruction）
	- 执行*一条指令*所需要的时钟周期数
	- CPI 是一个均值
	- 不同指令的时钟周期数可能不同 $\to$ 对于一个程序或一台机器来说，其CPI指*该程序或该机器指令集中*的所*有指令执行所需的平均时钟周期数*
	- 区分：
		- 单周期 CPU：CPI=1
		- 多周期 CPU：CPI>1，一个指令要分阶段多个时钟周期完成
		- 基本流水线：一般 CPI>1, 理想状况下 CPI=1
		- 超标量流水线：CPI<1 (会并行执行多条流水线)
- IPS-Instruction Per Second
	- 每*秒*执行多少条指令
	- 公式：
		- $IPS= \frac{主频}{平均 CPI}$（实际上 CPI 本就是个平均值）
	- MIPS（百万）
- FLOPS（Floating-point Operations Per Second）
	- 每秒执行多少次*浮点运算*
	- 常用 MFLOPS，GFLOPS，TFLOPS，PFLOPS，EFLOPS，ZFLOPS
**概念**
- CPU 执行时间
	- CPU 的性能主要取决于三个要素：主频，CPI，指令条数
	- $CPU 执行时间=\frac{CPU 时钟周期数}{主频}=\frac{指令条数\times CPI}{主频}$
**概念**（不想码了）
- 基准程序
- 系列机
- 兼容
- 固件

